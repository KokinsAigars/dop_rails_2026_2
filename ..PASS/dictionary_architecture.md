ğŸ“˜ Project Summary: Dictionary Search & Entry System1. Data ArchitectureWe use a Master-Detail structure with a high-speed Flat Search Index.dic_vocab: A simplified, non-versioned table used strictly for search. It contains term, term_norm, and lang.dic_index: The "Head" record (UUID). Represents a single concept or word entry regardless of language. Contains source metadata (file, order) and homograph numbers.dic_entry: The language-specific content (Pali, Latvian, English) tied to a dic_index via fk_index_id.2. Search & Normalization LogicTo handle PÄÄ¼i and Latvian special characters, we use a Unified Normalizer. This ensures that searching for asl finds ÄÅ¡Ä¼.Normalization Rules:Flattening: ÄÄ«Å«á¹ƒá¹‡Ã±á¹­á¸á¸·Å¡ÄÅ¾Ä“Ä£Ä·Ä¼Å†Å— $\rightarrow$ aiumnntdlsczegklnr.Cleaning: Downcase and remove all non-letter characters.Implementation: Stored in Sc03Dictionary::DicVocab.normalize(text) for use in both the search controller and the maintenance Rake task.3. Database OptimizationWe replaced standard B-Tree indexes with GIN Trigram Indexes to allow "Search Inside" (fuzzy) functionality.Index: idx_dic_vocab_term_norm_trgm using gin_trgm_ops.Search Strategy:Exact Match: Ranked 0 (Top).Starts With: Ranked 1.Contains/Fuzzy: Ranked 2.Compound: Specifically looks for matches after a dash (e.g., %-baddha).4. Search UI (Hotwire/Turbo)Live Search: Uses a Stimulus controller (search_controller.js) with a 300ms debounce to prevent server spam.Focus Preservation: The <turbo-frame> is placed below the search form. This ensures the input field is never replaced by Turbo, so the user never loses their cursor focus while typing.5. View Layer (The Partial Family)The Entries#show page is modular. It "jumps back" from the Entry to the Index Head, then renders all related language versions using these partials:_notes: Main definitions and revision comments._quotes: Text citations with Pali/Latvian formatting._egs: Usage examples (Pali text + Translation)._refs: Cross-reference buttons linking to other words._scans: Thumbnails for original manuscript images (tied to dic_index).6. Maintenance Taskbin/rails dictionary:rebuild_vocabPurges the dic_vocab table.Collects all is_current: true entries.Filters out blank names.Caps string lengths at 250 characters to prevent Postgres B-Tree page limits.Performs high-speed bulk insertion via raw SQL.
