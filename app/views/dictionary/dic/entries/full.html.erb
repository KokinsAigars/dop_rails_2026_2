
<div class="article-layout">

  <%= render 'dictionary/shared/dic_home_links' %>

  <div class="title-article-h1">
    <h1><%= @pali_entry&.name %></h1>
  </div>

  <div class="sub-title-article-h1">
    <h6>Last modified: <%= @index.modified_date.to_date %></h6>
  </div>

  <%# INDEX %>
  <div data-controller="toggle" data-toggle-open-value="false">
    <button data-action="click->toggle#toggle" class="btn">
      <i data-toggle-target="icon" class="bi bi-chevron-right" ></i>
      <strong>metadata</strong>
    </button>
    <div data-toggle-target="content" class="library-card-container">
      <strong>Index</strong>
      <p>id:                <%= @index.id %></p>
      <p>dictionary:        <%= @index.dictionary %></p>
      <p>entry_no:          <%= @index.entry_no %></p>
      <p>homograph:         <%= @index.homograph %></p>
      <p>homograph_no:      <%= @index.homograph_no %></p>
      <p>homograph_uuid:    <%= @index.homograph_uuid %></p>
      <p>source_file:       <%= @index.source_file %></p>
      <p>source_order:      <%= @index.source_order %></p>
      <p>xml_index_id:      <%= @index.xml_index_id %></p>
      <p>revision:          <%= @index.revision %></p>
      <p>revision_comment:  <%= @index.revision_comment %></p>
      <p>root_id:           <%= @index.root_id %></p>
      <p>version:           <%= @index.version %></p>
      <p>is_current:        <%= @index.is_current %></p>
      <p>superseded_at:     <%= @index.superseded_at %></p>
      <p>superseded_by:     <%= @index.superseded_by %></p>
      <p>created_at:        <%= @index.created_at %></p>
      <p>modified_date:     <%= @index.modified_date %></p>
      <p>modified_by:       <%= @index.modified_by %></p>
      <div class="vertical-space"></div>
      <p>
        <strong>Last Modified By:</strong>  <%= @index.actor["fullname"] %> via <%= @index.source["app"] %>
        <br>
        <strong>Last modified: </strong>    <%= @index.modified_date.to_date %></h6>
      </p>
    </div>
  </div>

  <div class="vertical-space"></div>


  <div class="card-body p-4">
    <%# LOOP THROUGH EVERY LANGUAGE ENTRY %>
    <% @all_entries.each do |entry| %>
      <section class="language-block mb-5 p-3 border-start border-4 <%= entry.lang == 'pi' ? 'border-primary' : 'border-success' %>">

        <div class="d-flex justify-content-between">
          <h2 class="h4">
            <span class="badge bg-secondary me-2"><%= entry.lang.upcase %></span>
            <%= entry.name %>
          </h2>
          <span class="text-muted italic"><%= entry.grammar %> (<%= entry.gender %>)</span>
        </div>

        <%# Translation text if available %>
        <% if entry.dic_eng_tr.present? %>
          <p class="fs-5"><%= entry.dic_eng_tr %></p>
        <% end %>

        <%# EXAMPLES & QUOTES (Specific to THIS language record) %>
        <div class="row mt-3">
          <div class="col-md-6">
            <h6>Examples (<%= entry.lang.upcase %>)</h6>
            <% entry.dic_egs.each do |eg| %>
              <div class="small bg-light p-2 mb-1 border rounded"><%= eg.content %></div>
            <% end %>
          </div>

          <%# 1. The Wrapper: Controller and Value must be together %>
          <div data-controller="toggle" data-toggle-open-value="false" class="col-md-6 mb-3">

            <%# 2. The Trigger: Must be inside the wrapper %>
            <button data-action="click->toggle#toggle" class="btn btn-sm btn-link text-decoration-none p-0">
              <i class="bi bi-chevron-right" data-toggle-target="icon"></i>
              <strong>Scholar Notes</strong>
            </button>

            <%# 3. The Target: Must be inside the wrapper %>
            <div data-toggle-target="content">
              <p>Contrary to popular belief, Lorem Ipsum...</p>
              <% entry.dic_notes.each do |note| %>
                <div class="small text-warning-emphasis"><%= note.content %></div>
              <% end %>
            </div>

          </div>
        </div>


      </section>
    <% end %>
  </div>


  <%# SCANS (Attached to the Index, shown at the bottom) %>
  <% if @index.dic_scans.any? %>
      <strong>Source Scans</strong>

      <% @index.dic_scans.each do |scan| %>
        <div class="library-card-container">
          <p>id: <%= scan.id %> </p>
          <p>fk_index_id: <%= scan.fk_index_id %> </p>
          <p>scan_version: <%= scan.scan_version %> </p>
          <p>scan_filename: <%= scan.scan_filename %> </p>
          <p>scan_note: <%= scan.scan_note %> </p>
          <p>scan_text: <%= scan.scan_text %> </p>
          <p>scan_text_raw: <%= scan.scan_text_raw %> </p>
          <p>scan_meta: <%= scan.scan_meta %> </p>
          <p>scan_status: <%= scan.scan_status %> </p>
          <p>revision: <%= scan.revision %> </p>
          <p>revision_comment: <%= scan.revision_comment %> </p>
          <p>root_id: <%= scan.root_id %> </p>
          <p>version: <%= scan.version %> </p>
          <p>is_current: <%= scan.is_current %> </p>
          <p>superseded_at: <%= scan.superseded_at %> </p>
          <p>superseded_by: <%= scan.superseded_by %> </p>
          <p>created_at: <%= scan.created_at %> </p>
          <p>modified_date: <%= scan.modified_date %> </p>
          <p>modified_by: <%= scan.modified_by %> </p>
        </div>
      <% end %>
  <% end %>




</div>

